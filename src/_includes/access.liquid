<section class="bg-gray-50 px-4 py-12">
  <h2 class="mb-6 text-xl font-semibold">場所・アクセス</h2>

  <div class="mb-4 text-sm leading-relaxed">
    <p>〒{{ info.address.zip }}</p>
    <p>
      {{ info.address.pref -}}
      {{- info.address.city -}}
      {{- info.address.street }}
    </p>
    <p>「上長田郵便局」すぐ隣</p>
    <p>駐車場: あり (5台)</p>
  </div>

  <div class="mb-4 text-sm leading-relaxed">
    <p>
      電話番号:
      <span>
        <a
          href="tel:{{ info.tel | remove: ' ' }}"
          class="text-blue-600 underline"
        >
          {{ info.tel }}
        </a>
      </span>
    </p>
    <p>営業時間: {{ info.businessHours }}</p>
    <p>定休日: {{ info.openDays }}</p>
    <p>お支払い方法: 現金のみ、PayPay・クレジットカード等の電子決済はご利用いただけません。</p>
  </div>

  <script>
    // Alpine の初期化イベントを待つ
    function initMapComponent() {
      Alpine.data('mapComponent', () => ({
        initMap() {
          this.$nextTick(() => {
            const mapContainer = document.getElementById('map');
            if (!mapContainer) return;

            const lat = parseFloat(mapContainer.dataset.lat);
            const lng = parseFloat(mapContainer.dataset.lng);
            const company = mapContainer.dataset.company || '';
            const pref = mapContainer.dataset.pref || '';
            const city = mapContainer.dataset.city || '';
            const street = mapContainer.dataset.street || '';

            if (!Number.isFinite(lat) || !Number.isFinite(lng)) {
              console.warn('Invalid coordinates:', { lat, lng });
              return;
            }

            try {
              const map = L.map(mapContainer).setView([lat, lng], 13);

              L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
              }).addTo(map);

              L.marker([lat, lng]).addTo(map).bindPopup(`${company}<br>${pref} ${city} ${street}`).openPopup();

              console.log('Map initialized successfully');
            } catch (error) {
              console.error('Map initialization error:', error);
            }
          });
        },
      }));
    }
    if (typeof Alpine !== 'undefined' && Alpine.version) {
      initMapComponent();
    } else {
      document.addEventListener('alpine:init', initMapComponent);
    }
  </script>
  <!-- Leaflet.js Map Container -->
  <div
    x-data="mapComponent()"
    x-init="initMap()"
    id="map"
    class="h-64 sm:h-96 w-full md:w-3xl mb-4"
    data-lat="{{ info.latitude }}"
    data-lng="{{ info.longitude }}"
    data-company="{{ info.companyName }}"
    data-pref="{{ info.address.pref }}"
    data-city="{{ info.address.city }}"
    data-street="{{ info.address.street }}"
  ></div>

  <div>
    <p>
      <a
        href="https://maps.app.goo.gl/esp86D2EaypwqxibA"
        target="_blank"
        rel="noopener noreferrer"
        class="text-blue-600 underline after:content-['_↗']"
      >
        Google Mapsで見る
      </a>
    </p>
  </div>
</section>
